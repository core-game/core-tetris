webpackJsonp([1],[,function(t,i,n){"use strict";function e(t){return t&&t.__esModule?t:{default:t}}var r=n(15),o=e(r),s=n(11),a=e(s);n(4),new o.default({el:"#app",render:function(t){return t(a.default)}})},function(t,i,n){"use strict";var e,r,o,s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};(function(n,a){"object"===s(i)&&void 0!==t?a(i):(r=[i],e=a,void 0!==(o="function"==typeof e?e.apply(i,r):e)&&(t.exports=o))})(0,function(t){function i(t,i){void 0===t&&(t={}),void 0===i&&(i={});for(var n in i)t[n]=i[n];return t}function n(t){var i=Object.keys(t);return t[i[Math.floor(Math.random()*i.length)]]}function e(t){var i=t.length,n=t[0].length;if(!i||!n)return t;for(var e=[],r=0;r<n;r++){e.push([]);for(var o=0;o<i;o++)e[r][o]=t[o][r]}return e}function r(t){return t.map(function(t){return t.slice()})}function o(t){return r(t).map(function(t){return t.reverse()})}function s(t){return r(t).reverse()}function a(t,i){void 0===i&&(i=!0);var n=e(t);return i?o(n):s(n)}function h(t,i){return JSON.stringify(t)===JSON.stringify(i)}function c(t,i,n){void 0===n&&(n=0);for(var e=[],r=0;r<t;r++){e.push([]);for(var o=0;o<i;o++)e[r].push(n)}return e}function u(t){var i=t.array,n=t.startRow,e=t.endRow,r=t.startCol,o=t.endCol,s=i.length,a=i[0].length;if(s&&a){n=Math.min(Math.max(0,n),s),r=Math.min(Math.max(0,r),a),e=Math.min(Math.max(0,e),s),o=Math.min(Math.max(0,o),a);for(var h=[],c=0,u=e-n;c<u;c++){h.push([]);for(var l=0,f=o-r;l<f;l++)h[c].push(i[c+n][l+r])}return h}}function l(t,i,n){void 0===i&&(i=0),void 0===n&&(n=0);var e=t.length;return e>i?t.slice():Array(i-e).fill(n).concat(t)}function f(t,i,n){void 0===n&&(n=0);var e=t.length;if(e>i)return t.slice();var r=Array(i-e).fill(n);return t.concat(r)}function p(t,i,n){void 0===i&&(i=0),void 0===n&&(n=0);var e=t.length;if(i>=0)return f(t,e+i,n);var r=-i;return r>e?[]:t.slice(0,e-r)}function d(t,i){var n=t.length,e=i.length,r=n-e,o=t.slice(),s=i.slice();r>0?s=l(s,n):r<0&&(o=l(o,e));for(var a=0,h=o.length;a<h;a++)if(o[a]&&s[a])return!0;return!1}function v(t,i){var n=t.length,e=i.length,r=n-e,o=t.slice(),s=i.slice();r>0?s=l(s,n):r<0&&(o=l(o,e));for(var a=[],h=0,c=o.length;h<c;h++)a[h]=s[h]||o[h];return a}function m(t,i){for(var n=Math.min(t.length,i.length),e=0,r=n;e<r;e++)if(d(t[e],i[e]))return!0;return!1}function y(t,i,n){return void 0===i&&(i=0),void 0===n&&(n=0),t.map(function(t){return p(t,i,n)})}function x(t,i,n){void 0===n&&(n=0),t=r(t);var e=t.length;if(!e)return t;var o=i-e,s=t[0].length;return o<=0||s<=0?t:c(o,s,n).concat(t)}function _(t,i){for(var n=r(t),e=0,o=Math.min(t.length,i.length);e<o;e++)n[e]=v(t[e],i[e]);return n}function g(t){var i=t.block,n=t.startX,e=t.endX,r=t.startY,o=t.endY,s=i.x,a=i.y;return{array:u({array:i.array,startCol:n-s,endCol:e-s,startRow:r-a,endRow:o-a}),x:s,y:a}}function b(t,i){var n=t.x,e=t.y,r=t.array,o=r.length,s=r[0].length,a=n,h=a+s,c=e,u=c+o,l=i.x,f=i.y,p=i.array,d=p.length,v=p[0].length,y=l,x=y+v,_=f,b=_+d;if(h<y||u<_)return!1;if(a>x||c>b)return!1;var k=Math.max(a,y),w=Math.max(c,_),M=Math.min(h,x),C=Math.min(u,b),S=g({block:t,startX:k,endX:M,startY:w,endY:C}),j=g({block:i,startX:k,endX:M,startY:w,endY:C});return m(S.array,j.array)}function k(t,i){var n=t.x,e=t.y,o=t.array,s=o.length,a=o[0].length,h=n,c=h+a,u=e,l=u+s,f=i.x,p=i.y,d=i.array,v=d.length,m=d[0].length,x=f,b=x+m,k=p,w=k+v;if(c<x||l<k)return t;if(h>b||u>w)return t;var M=Math.max(h,x),C=Math.max(u,k),S=Math.min(c,b),j=Math.min(l,w),O=g({block:t,startX:h,endX:c,startY:C,endY:j}),X=g({block:i,startX:M,endX:S,startY:C,endY:j}),Y=_(O.array,y(X.array,c-S)),B=r(o);return B.splice.apply(B,[C,j-C].concat(Y)),{array:B,x:h,y:u}}function w(t){return t?X[t].clone():n(X)}var M=function(t){this._options=i({row:20,col:10,x:0,y:0},t),this.x=this._options.x,this.y=this._options.y,this.row=this._options.row,this.col=this._options.col,this.reset()},C={coordinate:{}};C.coordinate.get=function(){return{x:this.x,y:this.y,array:this.matrix}},M.prototype.reset=function(){this.matrix=c(this.row,this.col)},Object.defineProperties(M.prototype,C);var S=function(t){void 0===t&&(t=[]),this._shape=t,this._index=0,this.maxCol=this.maxRow=t.length,this._init()},j={shape:{},index:{},margin:{}};S.prototype.clone=function(){return new S(this._shape)},j.shape.get=function(){return this._shapes[this._index]},j.index.get=function(){return this._index},j.index.set=function(t){this._index=t},j.margin.get=function(){var t=Array(this.maxCol).fill(0).join(""),i=this.shape,n=function(i){var n=0,e=0,r=0;return i.map(function(t){return t.join("")}).forEach(function(i){i===t?e?r++:n++:e++}),{start:n,block:e,end:r}},e=n(i),r=e.start,o=e.block,s=e.end,h=n(a(i));return{top:r,row:o,bottom:s,left:h.start,col:h.block,right:h.end}},S.prototype.rotate=function(t){void 0===t&&(t=!0),t?this._index++:this._index--;var i=this._shapes.length;return this._index<0&&(this._index=i-1),this._index>=i&&(this._index=0),this.shape},S.prototype._init=function(){for(var t=this,i=t._shape,n=[i],e=i;;){if(e=a(e),h(e,i))break;n.push(e)}this._shapes=n},Object.defineProperties(S.prototype,j);var O={I:[[0,0,0,0],[0,0,0,0],[1,1,1,1],[0,0,0,0]],J:[[0,0,0],[1,1,1],[0,0,1]],L:[[0,0,0],[1,1,1],[1,0,0]],O:[[1,1],[1,1]],S:[[0,0,0],[0,1,1],[1,1,0]],T:[[0,0,0],[1,1,1],[0,1,0]],Z:[[0,0,0],[1,1,0],[0,1,1]]},X={};for(var Y in O)X[Y]=new S(O[Y]);var B=function(t){this._options=i({x:0,y:0,shape:w()},t),this.x=this._options.x,this.y=this._options.y,this.shape=this._options.shape},P={coordinate:{}};P.coordinate.get=function(){return{x:this.x,y:this.y,array:this.shape.shape}},B.prototype.moveBy=function(t,i){void 0===t&&(t=0),void 0===i&&(i=0),this.x+=t,this.y+=i},B.prototype.moveTo=function(t,i){void 0===t&&(t=0),void 0===i&&(i=0),this.x=t,this.y=i},B.prototype.rotate=function(t){void 0===t&&(t=!0),this.shape.rotate(t)},Object.defineProperties(B.prototype,P);var R=function(t){var n=this;this._options=i({matrix:new M,auto:!0,speed:500},t),this._events={},this._bind(),this.reset(),this.on("hit",function(){n.block.y+n.block.shape.margin.top<n.matrix.y?n.fail():n._next()})},T={graph:{}};T.graph.get=function(){var t=this.block,i=t.coordinate;return k(this.matrix.coordinate,i)},Object.defineProperties(R.prototype,T),function(t){var i=t.prototype;i.reset=function(){this.auto=this._options.auto,this.speed=this._options.speed,this.matrix=this._options.matrix,this.matrix.reset(),this._paused=!1,this._failed=!1,this.addBlock(),this.pause(),this.resume(),this.emit("repaint",this.graph)},i.pause=function(){this._paused=!0,this._timeout&&(clearTimeout(this._timeout),this._timeout=null)},i.resume=function(){this._paused=!1,this._timeout||this._process()},i.fail=function(){this._failed=!0,this._paused=!0,this.emit("repaint",this.graph),this.emit("failed")},i.start=i.reset,i._process=function(){var t=this,i=this,n=i.auto,e=i.speed;(function i(){n&&e&&!t._paused&&(t._timeout=setTimeout(function(){t.down(),i()},e))})()},i._next=function(){this._union(),this._clearLines(),this.addBlock()}}(R),function(t){var i=t.prototype;i.down=function(){return!this._failed&&(this.save(),this.block.moveBy(0,1),this._detectCollision()?(this.restore(),this.emit("hit"),!1):(this.emit("repaint",this.graph),!0))},i.left=function(){return!this._failed&&(this.save(),this.block.moveBy(-1,0),this._detectCollision()?(this.restore(),this.emit("overflow:left"),!1):(this.emit("repaint",this.graph),!0))},i.right=function(){return!this._failed&&(this.save(),this.block.moveBy(1,0),this._detectCollision()?(this.restore(),this.emit("overflow:right"),!1):(this.emit("repaint",this.graph),!0))},i.rotate=function(){return!this._failed&&(this.save(),this.block.rotate(),this._detectCollision()?(this.restore(),this.emit("hit:rotate"),!1):(this.emit("repaint",this.graph),!0))},i.addBlock=function(t){if(this._failed)return!1;t||(t=new B);var i=this.matrix,n=i.col,e=(i.row,t.shape),r=e.margin,o=Math.floor((n-r.col)/2)-r.left,s=0-r.row-r.top;t.moveTo(o,s),this.block=t}}(R),function(t){var i=t.prototype;i.on=function(t,i){this._events[t]||(this._events[t]=[]),this._events[t].push(i)},i.emit=function(t){for(var i=[],n=arguments.length-1;n-- >0;)i[n]=arguments[n+1];var e=this;(this._events[t]||[]).forEach(function(t){t.apply(e,i)})}}(R),function(t){var i=t.prototype;i.save=function(){this._lastState={matrix:{x:this.matrix.x,y:this.matrix.y,matrix:r(this.matrix.matrix)},block:{x:this.block.x,y:this.block.y,index:this.block.shape.index}}},i.restore=function(){var t=this._lastState,i=t.matrix,n=t.block;this.matrix.x=i.x,this.matrix.y=i.y,this.matrix.matrix=r(i.matrix),this.block.x=n.x,this.block.y=n.y,this.block.shape.index=n.index}}(R),function(t){t.prototype._bind=function(){var t=this;document.addEventListener("keydown",function(i){switch(i.which){case 32:for(;t.down(););case 37:t.left();break;case 38:t.rotate();break;case 39:t.right();break;case 40:t.down()}})}}(R),function(t){var i=t.prototype;i._union=function(){this.matrix.matrix=k(this.matrix.coordinate,this.block.coordinate).array},i._clearLines=function(){for(var t=this.matrix,i=t.matrix,n=i.length,e=[],r=[],o=n-1;o>=0;o--){for(var s=i[o],a=!0,h=!0,c=0,u=s.length;c<u&&(s[c]?a=!1:h=!1,a||h);c++);h?r.unshift(o):e.unshift(s)}return r.length&&this.emit("clear:lines",r),this.matrix.matrix=x(e,n),r}}(R),function(t){t.prototype._detectCollision=function(){var t=this,i=t.matrix,n=t.block,e=i.x,r=i.x+i.col,o=i.y+i.row,s=n.coordinate,a=s.x,h=s.y,c=n.shape,u=c.margin;return a+u.left<e||a+u.left+u.col>r||h+u.top+u.row>o||!!b(this.matrix.coordinate,this.block.coordinate)}}(R),t.Tetris=R,t.Shape=S,t.Block=B,t.Matrix=M,t.default=R,Object.defineProperty(t,"__esModule",{value:!0})})},function(t,i,n){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var e=n(2);i.default={name:"tetris",data:function(){return{tetris:null,graph:Array(20).fill(Array(15))}},mounted:function(){this.init()},methods:{init:function(){var t=this;this.tetris=new e.Tetris({matrix:new e.Matrix({row:20,col:15})}),this.tetris.on("repaint",function(i){t.graph=i.array}),this.tetris.on("failed",function(){alert("Failed!")})},start:function(){console.log("start"),this.tetris.start()}}}},function(t,i,n){"use strict";var e=n(10),r=function(t){return t&&t.__esModule?t:{default:t}}(e);r.default.install({onUpdateReady:function(){console.log("update ready"),r.default.applyUpdate()},onUpdated:function(){console.log("updated"),location.reload()}})},,,function(t,i){},,,,function(t,i,n){n(7);var e=n(12)(n(3),n(13),null,null);t.exports=e.exports},,function(t,i){t.exports={render:function(){var t=this,i=t.$createElement,n=t._self._c||i;return n("div",{attrs:{id:"app"}},[n("div",{staticClass:"game"},[n("ul",{staticClass:"row"},t._l(t.graph,function(i){return n("li",[n("ul",{staticClass:"col"},t._l(i,function(t){return n("li",{staticClass:"rect",class:{filled:t}},[n("div")])}))])}))]),t._v(" "),n("div",{staticClass:"controls"},[n("a",{staticClass:"button",on:{click:t.start}},[t._v("Start")])]),t._v(" "),t._m(0)])},staticRenderFns:[function(){var t=this,i=t.$createElement,n=t._self._c||i;return n("p",[t._v("Powered by "),n("a",{attrs:{href:"//github.com/wasd-org/wasd-tetris"}},[t._v("wasd-tetris")])])}]}},,,function(t,i,n){t.exports=n(1)}],[16]);
//# sourceMappingURL=client.dc55b201.js.map